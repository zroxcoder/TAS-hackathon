<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Courses | Edumate</title>


<link rel="icon" href="../assets/E.ico" type="image/x-icon">

<style>
:root {
    --primary-orange: #ffb56b;
    --soft-orange: #ffe0c2;
    --dark-text: #333;
    --light-bg: #ffffff;
}

#sidebar { width:260px;height:100vh;position:fixed;left:0;top:0;background:var(--soft-orange);padding-top:20px;overflow-y:auto;box-shadow:5px 0 12px rgba(0,0,0,0.1);}
#sidebar h3 { font-size:30px;font-weight:900;letter-spacing:1px;text-transform:uppercase;text-shadow:2px 2px 4px rgba(0,0,0,0.2);margin-left:20px;text-align:left;animation:fadeIn 1s ease-in-out;}
#sidebar .nav-link { display:block;color:var(--dark-text);font-weight:600;margin:6px 10px;padding:10px 15px;border-radius:10px;transition:0.25s ease-in-out;text-decoration:none;}
#sidebar .nav-link:hover,#sidebar .nav-link.active { background:var(--primary-orange); color:#000; transform:translateX(5px); }


.content { margin-left:260px;padding:30px;min-height:100vh;background:var(--light-bg);}
.section-title { font-size:26px;font-weight:800;margin-bottom:25px; }
.top-controls { display:flex;gap:15px;margin-bottom:20px;}
.top-controls input,.top-controls select { padding:10px;border-radius:8px;border:1px solid #aaa;}


.course-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px;}
.course-card { background:var(--soft-orange);border-radius:12px;padding:15px;box-shadow:0 4px 10px rgba(0,0,0,0.15);position:relative;animation:fadeIn 0.6s;}
.course-card h3 { margin:0; }
.priority-high { color:red;font-weight:bold; }
.priority-medium { color:orange;font-weight:bold; }
.priority-low { color:green;font-weight:bold; }


.pin,.fav { position:absolute; right:12px; font-size:20px; cursor:pointer;}
.pin { top:12px; } .pin.active { color:gold; }
.fav { top:40px; } .fav.active { color:red; }


.add-btn { position:fixed; right:40px; bottom:40px; background:var(--primary-orange); color:#fff; font-size:30px; width:65px; height:65px; border-radius:50%; border:none; box-shadow:0 4px 12px rgba(0,0,0,0.3); cursor:pointer;}


.modal { position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.45); display:none; justify-content:center; align-items:center; }
.modal-content { background:var(--soft-orange); padding:25px; width:480px; max-width:92vw; box-sizing:border-box; border-radius:12px; box-shadow:0 4px 10px black; }
.modal-content input, .modal-content textarea, .modal-content select { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #aaa; box-sizing:border-box; font-size:14px; }
.modal-content textarea { min-height:120px; resize:vertical; }
.modal-content button { background:var(--primary-orange); padding:10px 20px; border:none; margin-right:8px; border-radius:8px; cursor:pointer; }

@keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
</style>
</head>
<body>

<div id="sidebar">
<h3>EDUMATE</h3>
<a class="nav-link" href="dashboard.html">üìä Dashboard</a>
<a class="nav-link" href="notes.html">üìù Notes</a>
<a class="nav-link" href="planner.html">üìÖ Planner</a>
<a class="nav-link" href="projects.html">üìÅ Projects</a>
<a class="nav-link active" href="courses.html">üéì Courses</a>
<a class="nav-link" href="aichatbot.html">ü§ñ Chat Bot</a>
<a class="nav-link" href="profile.html">‚öôÔ∏è Profile</a>
</div>

<div class="content">
<h2 class="section-title">Your Courses</h2>
<div class="top-controls">
<input type="text" id="searchInput" onkeyup="loadCourses()" placeholder="Search courses...">
<select id="priorityFilter" onchange="loadCourses()">
<option value="all">All Priorities</option>
<option value="High">High Priority</option>
<option value="Medium">Medium Priority</option>
<option value="Low">Low Priority</option>
</select>
</div>
<div class="course-grid" id="courseList"></div>
</div>

<button class="add-btn" onclick="openModal()">+</button>

<div id="courseModal" class="modal">
<div class="modal-content">
<h3 id="modalTitle">Add New Course</h3>
<input type="text" id="courseTitle" placeholder="Course Name">
<textarea id="courseDesc" placeholder="Description"></textarea>
<input type="text" id="courseTags" placeholder="Tags (comma separated)">
<input type="date" id="courseStart">
<input type="date" id="courseEnd">
<select id="coursePriority">
<option value="Low">üåø Low Priority</option>
<option value="Medium">‚ö° Medium Priority</option>
<option value="High">üî• High Priority</option>
</select>
<button onclick="saveCourse()">Save</button>
<button onclick="closeModal()">Cancel</button>
</div>
</div>

<script>
let db; let editID=null;

function openDB() {
    return new Promise((resolve,reject)=>{
        const req=indexedDB.open("MateDB",3);
            req.onupgradeneeded = e => {
                db=e.target.result;
                ["tasks","notes","projects","courses","profile","activity","certificates","chats","searches"].forEach(store=>{
                    if(!db.objectStoreNames.contains(store)) db.createObjectStore(store,{keyPath:"id",autoIncrement:true});
                });
            };
        req.onsuccess = e => { db=e.target.result; resolve(db); };
        req.onerror = e => reject(e);
    });
}
function get(store,key){return new Promise(resolve=>{ const tx=db.transaction(store,"readonly"); const req=tx.objectStore(store).get(key); req.onsuccess=()=>resolve(req.result); req.onerror=()=>resolve(null); });}
function getAll(store){return new Promise(resolve=>{ const tx=db.transaction(store,"readonly"); const req=tx.objectStore(store).getAll(); req.onsuccess=()=>resolve(req.result); req.onerror=()=>resolve([]); });}
function add(store,obj){return new Promise(resolve=>{ const tx=db.transaction(store,"readwrite"); const req=tx.objectStore(store).add(obj); req.onsuccess=()=>resolve(); });}
function put(store,obj){return new Promise(resolve=>{ const tx=db.transaction(store,"readwrite"); const req=tx.objectStore(store).put(obj); req.onsuccess=()=>resolve(); });}
function del(store,key){return new Promise(resolve=>{ const tx=db.transaction(store,"readwrite"); const req=tx.objectStore(store).delete(key); req.onsuccess=()=>resolve(); });}


function openModal(){ document.getElementById("courseModal").style.display="flex"; }
function closeModal(){ 
    document.getElementById("courseModal").style.display="none"; 
    editID=null;
    courseTitle.value=""; courseDesc.value=""; courseTags.value=""; courseStart.value=""; courseEnd.value=""; coursePriority.value="Low";
}


async function saveCourse(){

    let doneState = false;
    if(editID){
        const existing = await get("courses", editID);
        doneState = existing && existing.done ? true : false;
    }
    let course={
         title: courseTitle.value,
         description: courseDesc.value,
         tags: courseTags.value,
         startDate: courseStart.value,
         endDate: courseEnd.value,
         priority: coursePriority.value,
         pinned:false,
         fav:false,
         done: doneState,
         time:new Date().toLocaleString()
     };
     if(editID){ course.id=editID; await put("courses",course);}
     else await add("courses",course);
     closeModal(); loadCourses();
 }
 

 async function loadCourses(){
     const container=document.getElementById("courseList"); container.innerHTML="";
     const search=searchInput.value.toLowerCase();
     const filter=priorityFilter.value;
 
     let list=await getAll("courses");
     list=list.sort((a,b)=>b.pinned-a.pinned)
              .filter(c=>c.title.toLowerCase().includes(search))
              .filter(c=>filter==="all"||c.priority===filter);
 
     list.forEach(c=>{
         container.innerHTML+=`
         <div class="course-card">
            <span class="pin ${c.pinned?"active":""}" onclick="togglePin(${c.id},${c.pinned})">üìå</span>
            <label style="display:inline-block;margin-left:8px;">
                <input type="checkbox" onchange="toggleDone(${c.id}, this.checked)" ${c.done ? "checked" : ""}> Done
            </label>
            <span class="fav ${c.fav?"active":""}" onclick="toggleFav(${c.id},${c.fav})">üß°</span>
             <h3>${c.title}</h3>
             <p>${c.description}</p>
             <p><b>Tags:</b> ${c.tags}</p>
             <p><b>Start:</b> ${c.startDate} | <b>End:</b> ${c.endDate}</p>
             <p class="priority-${c.priority.toLowerCase()}">${c.priority}</p>
             <small>${c.time}</small><br><br>
             <button onclick="editCourse(${c.id})">Edit</button>
             <button onclick="deleteCourse(${c.id})">Delete</button>
         </div>`;
     });
 }
 

 async function editCourse(id){
     let c=await get("courses",id);
     editID=id; openModal();
     courseTitle.value=c.title; courseDesc.value=c.description; courseTags.value=c.tags;
     courseStart.value=c.startDate; courseEnd.value=c.endDate; coursePriority.value=c.priority;
 }
 

 async function toggleDone(id, state){
     let c = await get("courses", id);
     if(!c) return;
     c.done = !!state;
     await put("courses", c);

     try{ localStorage.setItem('edumate-update', JSON.stringify({time:Date.now(), store:'courses'})); }catch(e){}
     loadCourses();
 }
 
 async function deleteCourse(id){ await del("courses",id); loadCourses(); }
 async function togglePin(id,state){ let c=await get("courses",id); c.pinned=!state; await put("courses",c); loadCourses(); }
 async function toggleFav(id,state){ let c=await get("courses",id); c.fav=!state; await put("courses",c); loadCourses(); }


openDB().then(loadCourses);
</script>

</body>
</html>
